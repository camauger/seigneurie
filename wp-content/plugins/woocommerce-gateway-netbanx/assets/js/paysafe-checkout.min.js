!function(e){e(document).ready(function(){a.onInit()}),e(document.body).on("updated_checkout",function(){a.onUpdateCheckout()});var a={gatewayId:paysafe_checkoutjs_params.gatewayId||"netbanx",onInit:function(){a.bindFormSubmissions(),a.mimicCreateAccountToSaveToAccountCheckbox(),a.hideEmptySavedMethodsInput(),a.onSavedPaymentMethodInputsChange(),e(document.body).on("paysafeErrored",a.onError).on("checkout_error",a.resetErrors),a.getFormElement().on("change",a.resetErrors)},onUpdateCheckout:function(){a.mimicCreateAccountToSaveToAccountCheckbox(),a.hideEmptySavedMethodsInput(),a.onCreateAccountCheckboxChange()},bindFormSubmissions:function(){if(e("#paysafe_checkout_payment_form").on("submit",a.makeToken),a.isAddPaymentMethodPage()){var o=a.getFormElement();o.off("submit"),o.on("submit",function(e){return!a.isPaysafeChecked()||(a.makeToken(e),!1)})}if(a.isChangePaymentMethodPage()){var t=a.getFormElement();t.off("submit"),t.on("submit",function(e){return!a.isPaysafeChecked()||(!a.isPayingWithNewMethod()||(a.makeToken(e),!1))})}},makeToken:function(o){o.preventDefault();var t={amount:parseInt(a.isUndefined(paysafe_iframe_params.options.amount)?0:paysafe_iframe_params.options.amount),currency:paysafe_iframe_params.options.currency,companyName:paysafe_iframe_params.options.companyName,holderName:paysafe_iframe_params.options.holderName,environment:paysafe_iframe_params.options.environment,locale:paysafe_iframe_params.options.locale,preferredPaymentMethod:paysafe_iframe_params.options.preferredPaymentMethod};a.isUndefined(paysafe_iframe_params.options.accounts)||(t.accounts={CC:parseInt(paysafe_iframe_params.options.accounts.CC)}),a.isUndefined(paysafe_iframe_params.options.billingAddress)||(t.billingAddress=paysafe_iframe_params.options.billingAddress),""!==paysafe_iframe_params.options.imageUrl&&(t.imageUrl=paysafe_iframe_params.options.imageUrl),""!==paysafe_iframe_params.options.buttonColor&&(t.buttonColor=paysafe_iframe_params.options.buttonColor),a.consoleLog("maketoken: options: ",t),e(document.body).triggerHandler("wc_paysafe_chechout_iframe_options",t),a.block(a.getFormElement());var n=!1;paysafe.checkout.setup(paysafe_checkoutjs_params.publicKey,t,function(o,t,r){if(a.consoleLog("maketoken: result: ",{instance:o,error:t,result:r}),a.unblock(a.getFormElement()),null!=r&&r.token){var s=paysafe_iframe_params.processAction||"process_payment",c=e("input[name='wc-"+a.gatewayId+"-save-to-account']").prop("checked"),i={security:paysafe_checkoutjs_params.nonce[s],token:r.token,payment_method:r.paymentMethod,save_to_account:c};"process_payment"===s?i.order_id=paysafe_iframe_params.options.orderId:"update_payment_method"===s?(i.user_id=paysafe_iframe_params.options.userId,i.update_token_id=paysafe_iframe_params.options.update_token_id):"add_payment_method"===s?i.user_id=paysafe_iframe_params.options.userId:"change_payment_method"===s&&(i.order_id=paysafe_iframe_params.options.orderId),e.ajax({type:"POST",data:i,url:a.formatAjaxURL(s),success:function(e){1==e.success?(o.showSuccessScreen(e.data.message),n=!0):o.showFailureScreen(e.data.message)}})}else null!=o?o.showFailureScreen(" Error: "+t.displayMessage):e(document.body).trigger("paysafeErrored",t.displayMessage+" "+t.detailedMessage),a.unblock(a.getFormElement())},function(o){if(e(document.body).triggerHandler("wc_paysafe_iframe_closed",[o,n]),"AfterPayment"===o){if(n){var t=a.getFormElement();a.block(t),window.parent.location.href=paysafe_iframe_params.urls.successRedirectPage}}else a.unblock(a.getFormElement())})},onCreateAccountCheckboxChange:function(){e("form.woocommerce-checkout").on("change","input#createaccount",a.mimicCreateAccountToSaveToAccountCheckbox)},onSavedPaymentMethodInputsChange:function(){a.getFormElement().on("change",".woocommerce-"+a.gatewayId+"-SavedPaymentMethods-tokenInput",function(){a.isPayingWithNewMethod()?a.maybeShowSaveToAccountCheckbox():a.hideSaveToAccountCheckbox()})},maybeShowSaveToAccountCheckbox:function(){var o=e("input#createaccount");a.showSaveToAccountCheckbox(),0<o.length&&a.mimicCreateAccountToSaveToAccountCheckbox()},mimicCreateAccountToSaveToAccountCheckbox:function(){var o=e("input#createaccount");0>=o.length||(o.is(":checked")?a.showSaveToAccountCheckbox():a.hideSaveToAccountCheckbox())},showSaveToAccountCheckbox:function(){var o=e(".wc-"+a.gatewayId+"-save-to-account");0!==o.length&&(a.hideSaveToAccountCheckbox(),o.show())},hideSaveToAccountCheckbox:function(){var o=e(".wc-"+a.gatewayId+"-save-to-account");0!==o.length&&o.hide()},hideEmptySavedMethodsInput:function(){var o=e(".woocommerce-"+a.gatewayId+"-SavedPaymentMethods-token-wrapper");0===o.data("count")&&o.hide()},formatAjaxURL:function(e){return paysafe_checkoutjs_params.ajaxUrl.toString().replace("%%endpoint%%","paysafe_"+e)},block:function(e,o){if(a.isUndefined(e))return!1;a.isMobile()||(o=a.isUndefined(o)?"":"<p>"+o+"</p>",e.block({message:o,overlayCSS:{background:"#fff",opacity:.6}}))},unblock:function(e){if(a.isUndefined(e))return!1;e.unblock()},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},consoleLog:function(e,o){o=o||{},a.isScriptDev()&&console.log(e,o)},isScriptDev:function(){return!a.isUndefined(paysafe_checkoutjs_params.scriptDev)&&"1"===paysafe_checkoutjs_params.scriptDev},isUndefined:function(e){return void 0===e},isPaysafeChecked:function(){return e("#payment_method_"+paysafe_checkoutjs_params.gatewayId).is(":checked")},isPayingWithNewMethod:function(){return e("#wc-"+paysafe_checkoutjs_params.gatewayId+"-payment-token-new").is(":checked")},isAddPaymentMethodPage:function(){return!a.isUndefined(paysafe_checkoutjs_params.isAddPaymentMethodPage)&&"1"===paysafe_checkoutjs_params.isAddPaymentMethodPage},isUpdatePaymentMethodPage:function(){return!a.isUndefined(paysafe_checkoutjs_params.isUpdatePaymentMethodPage)&&"1"===paysafe_checkoutjs_params.isUpdatePaymentMethodPage},isPayForOrderPage:function(){return!a.isUndefined(paysafe_checkoutjs_params.isPayForOrderPage)&&"1"===paysafe_checkoutjs_params.isPayForOrderPage},isCheckoutPage:function(){return!a.isUndefined(paysafe_checkoutjs_params.isCheckoutPage)&&"1"===paysafe_checkoutjs_params.isCheckoutPage},isChangePaymentMethodPage:function(){return!a.isUndefined(paysafe_checkoutjs_params.isChangePaymentMethodPage)&&"1"===paysafe_checkoutjs_params.isChangePaymentMethodPage},resetErrors:function(){e(".wc-paysafe-error").remove()},onError:function(o,t){var n=t;a.resetErrors(),a.getFormElement().append('<ul class="woocommerce_error woocommerce-error wc-paysafe-error"><li>'+n+"</li></ul>");var r=e(".wc-paysafe-error");r.length&&e("html, body").animate({scrollTop:r.offset().top-200},200)},getFormElement:function(){var o=e("#paysafe_checkout_payment_form");return a.isAddPaymentMethodPage()?o=e("#add_payment_method"):a.isChangePaymentMethodPage()&&(o=e("#order_review")),o}}}(jQuery);